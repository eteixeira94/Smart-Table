(function(e,t){"use strict";e.module("smart-table",[]).run(["$templateCache",function(e){e.put("template/smart-table/pagination.html",'<div class="pagination" ng-if="pages.length >= 2"><ul class="pagination">'+'<li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li>'+"</ul></div>")}]);e.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs",function(n,r,i,s){function g(e){return[].concat(e)}function y(){h=g(f(n));if(d===true){v.pipe()}}var o=s.stTable;var u=r(o);var a=u.assign;var f;var l=i("orderBy");var c=i("filter");var h=g(u(n));var p={sort:{},search:{},pagination:{start:0}};var d=true;var v=this;var m;n.$watch(o,function(){h=g(u(n))},true);if(s.stSafeSrc){f=r(s.stSafeSrc);n.$watch(function(){var e=f(n);return e?e.length:0},function(e,t){if(e!==h.length){y()}});n.$watch(function(){return f(n)},function(e,t){if(e!==t){y()}})}this.sortBy=function(t,n){p.sort.predicate=t;p.sort.reverse=n===true;p.pagination.start=0;this.pipe()};this.search=function(t,n){var r=p.search.predicateObject||{};var i=n?n:"$";r[i]=t;if(!t){delete r[i]}p.search.predicateObject=r;p.pagination.start=0;this.pipe()};this.pipe=function(){var r=p.pagination;var i=p.search.predicateObject?c(h,p.search.predicateObject):h;if(p.sort.predicate){i=l(i,p.sort.predicate,p.sort.reverse)}if(r.number!==t){r.numberOfPages=i.length>0?Math.ceil(i.length/r.number):1;r.start=r.start>=i.length?(r.numberOfPages-1)*r.number:r.start;i=i.slice(r.start,r.start+r.number)}a(n,i)};this.select=function(n,r){var i=h;var s=i.indexOf(n);if(s!==-1){if(r==="single"){n.isSelected=n.isSelected!==true;if(m){m.isSelected=false}m=n.isSelected===true?n:t}else{i[s].isSelected=!i[s].isSelected}}};this.slice=function(t,n){p.pagination.start=t;p.pagination.number=n;this.pipe()};this.tableState=function(){return p};this.setFilterFunction=function(t){c=i(t)};this.setSortFunction=function(t){l=i(t)};this.preventPipeOnWatch=function(){d=false}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(e,t,n,r){if(n.stSetFilter){r.setFilterFunction(n.stSetFilter)}if(n.stSetSort){r.setSortFunction(n.stSetSort)}}}});e.module("smart-table").directive("stSearch",["$timeout",function(e){return{require:"^stTable",scope:{predicate:"=?stSearch"},link:function(t,n,r,i){var s=i;var o=null;var u=r.stDelay||400;t.$watch("predicate",function(e,t){if(e!==t){i.tableState().search={};s.search(n[0].value||"",e)}});t.$watch(function(){return i.tableState().search},function(e,r){var i=t.predicate||"$";if(e.predicateObject&&e.predicateObject[i]!==n[0].value){n[0].value=e.predicateObject[i]||""}},true);n.bind("input",function(n){n=n.originalEvent||n;if(o!==null){e.cancel(o)}o=e(function(){s.search(n.target.value,t.predicate||"");o=null},u)})}}}]);e.module("smart-table").directive("stSelectRow",function(){return{restrict:"A",require:"^stTable",scope:{row:"=stSelectRow"},link:function(e,t,n,r){var i=n.stSelectMode||"single";t.bind("click",function(){e.$apply(function(){r.select(e.row,i)})});e.$watch("row.isSelected",function(e,n){if(e===true){t.addClass("st-selected")}else{t.removeClass("st-selected")}})}}});e.module("smart-table").directive("stSort",["$parse",function(n){return{restrict:"A",require:"^stTable",link:function(r,i,s,o){function p(){f++;if(f%3===0&&s.stSkipNatural===t){f=0;o.tableState().sort={};o.tableState().pagination.start=0;o.pipe()}else{o.sortBy(u,f%2===0)}}var u=s.stSort;var a=n(u);var f=0;var l=s.stClassAscent||"st-sort-ascent";var c=s.stClassDescent||"st-sort-descent";var h=[l,c];if(e.isFunction(a(r))){u=a(r)}i.bind("click",function(){if(u){r.$apply(p)}});if(s.stSortDefault!==t){f=s.stSortDefault==="reverse"?1:0;p()}r.$watch(function(){return o.tableState().sort},function(e){if(e.predicate!==u){f=0;i.removeClass(l).removeClass(c)}else{f=e.reverse===true?2:1;i.removeClass(h[f%2]).addClass(h[f-1])}},true)}}}]);e.module("smart-table").directive("stPagination",function(){return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?"},templateUrl:function(e,t){if(t.stTemplate){return t.stTemplate}return"template/smart-table/pagination.html"},link:function(e,t,n,r){function i(){var t=r.tableState().pagination;var n=1;var i;var s;e.currentPage=Math.floor(t.start/t.number)+1;n=Math.max(n,e.currentPage-Math.abs(Math.floor(e.stDisplayedPages/2)));i=n+e.stDisplayedPages;if(i>t.numberOfPages){i=t.numberOfPages+1;n=Math.max(1,i-e.stDisplayedPages)}e.pages=[];e.numPages=t.numberOfPages;for(s=n;s<i;s++){e.pages.push(s)}}e.stItemsByPage=e.stItemsByPage?+e.stItemsByPage:10;e.stDisplayedPages=e.stDisplayedPages?+e.stDisplayedPages:5;e.currentPage=1;e.pages=[];e.$watch(function(){return r.tableState().pagination},i,true);e.$watch("stItemsByPage",function(){e.selectPage(1)});e.$watch("stDisplayedPages",i);e.selectPage=function(t){if(t>0&&t<=e.numPages){r.slice((t-1)*e.stItemsByPage,e.stItemsByPage)}};r.slice(0,e.stItemsByPage)}}});e.module("smart-table").directive("stPipe",function(){return{require:"stTable",scope:{stPipe:"="},link:{pre:function(t,n,r,i){if(e.isFunction(t.stPipe)){i.preventPipeOnWatch();i.pipe=function(){t.stPipe(i.tableState(),i)}}}}}})})(angular)